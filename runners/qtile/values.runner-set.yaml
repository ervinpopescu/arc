githubConfigUrl: "https://github.com/ervinpopescu/qtile-cmd-client"

githubConfigSecret: "pre-defined-secret"

maxRunners: 8

minRunners: 0

template:
  spec:
    # securityContext:
    #   fsGroup: 123
    initContainers:
      - name: kube-init
        image: ghcr.io/actions/actions-runner:latest
        command: ["sudo", "chown", "-R", "1001:123", "/home/runner/_work", "/opt/hostedtoolcache"]
        volumeMounts:
          - name: work
            mountPath: /home/runner/_work
          - name: tool-cache
            mountPath: /opt/hostedtoolcache
    containers:
      - name: runner
        imagePullPolicy: Always
        image: ghcr.io/ervinpopescu/qtile-custom-runner:ubuntu-24.04
        command: ["/home/runner/run.sh"]
        env:
          - name: ACTIONS_RUNNER_CONTAINER_HOOKS
            value: /home/runner/k8s/index.js
          - name: ACTIONS_RUNNER_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: ACTIONS_RUNNER_REQUIRE_JOB_CONTAINER
            value: "false"
        volumeMounts:
          - name: work
            mountPath: /home/runner/_work
          - name: tool-cache
            mountPath: /opt/hostedtoolcache
    volumes:
      - name: work
        ephemeral:
          volumeClaimTemplate:
            spec:
              accessModes: [ "ReadWriteOnce" ]
              resources:
                requests:
                  storage: 1Gi
      - name: tool-cache
        persistentVolumeClaim:
          claimName: tool-cache-runnerset

namespaceOverride: "qtile-runners"
